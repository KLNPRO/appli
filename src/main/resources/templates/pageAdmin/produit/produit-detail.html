<!DOCTYPE html>
<html th:replace="base :: html" lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">

<div th:fragment="content">
    <div class="py-5">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/wickle}">Accueil</a></li>
                <li class="breadcrumb-item"><a th:href="@{/wickle/visiteur/produits}">Produits</a></li>
                <li class="breadcrumb-item"><a th:href="@{'/wickle/visiteur/produits/categorie/' + ${produit.categorie.id}}" th:text="${produit.categorie.nom}"></a></li>
                <li class="breadcrumb-item active" th:text="${produit.nom}"></li>
            </ol>
        </nav>

        <div class="row">
            <!-- Images du produit -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body p-5 text-center">
                        <div style="font-size: 15rem;">üëï</div>
                        <p class="text-muted">Photo du produit</p>
                    </div>
                </div>
            </div>

            <!-- Informations du produit -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body p-4">
                        <!-- Badge cat√©gorie -->
                        <span class="badge bg-secondary mb-3" th:text="${produit.categorie.nom}"></span>

                        <!-- Nom du produit -->
                        <h1 class="mb-3" th:text="${produit.nom}"></h1>

                        <!-- Prix -->
                        <div class="mb-4">
                            <span class="display-4 text-primary fw-bold" th:text="${produit.prix} + '‚Ç¨'"></span>
                        </div>

                        <!-- Description -->
                        <div class="mb-4">
                            <h5>Description</h5>
                            <p class="text-muted" th:text="${produit.description}"></p>
                        </div>

                        <!-- Informations suppl√©mentaires -->
                        <div class="mb-4">
                            <h5>Informations</h5>
                            <dl class="row">
                                <dt class="col-sm-4">Stock disponible</dt>
                                <dd class="col-sm-8">
                                    <span class="badge bg-success" th:if="${produit.stock > 10}" th:text="${produit.stock} + ' unit√©s'"></span>
                                    <span class="badge bg-warning text-dark" th:if="${produit.stock <= 10 && produit.stock > 0}" th:text="${produit.stock} + ' unit√©s'"></span>
                                    <span class="badge bg-danger" th:if="${produit.stock == 0}">Rupture de stock</span>
                                </dd>

                                <dt class="col-sm-4">Date d'ajout</dt>
                                <dd class="col-sm-8" th:text="${#temporals.format(produit.dateAjout, 'dd/MM/yyyy')}"></dd>

                                <dt class="col-sm-4">Variantes</dt>
                                <dd class="col-sm-8" th:text="${produit.variantes.size()} + ' variante(s)'"></dd>
                            </dl>
                        </div>

                        <!-- Formulaire d'ajout au panier (uniquement pour les clients connect√©s) -->
                        <div sec:authorize="hasRole('CLIENT')" th:if="${produit.stock > 0}">
                            <form th:action="@{/wickle/client/panier/ajouter}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                                <!-- S√©lection de la variante -->
                                <div class="mb-3" th:if="${!produit.variantes.empty}">
                                    <label class="form-label">Choisir une variante</label>
                                    <select class="form-select" name="varianteId" required>
                                        <option value="">-- S√©lectionnez --</option>
                                        <option th:each="variante : ${produit.variantes}"
                                                th:value="${variante.id}"
                                                th:text="${variante.couleur + ' - ' + variante.taille + ' (Stock: ' + variante.stock + ')'}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Quantit√© -->
                                <div class="mb-3">
                                    <label class="form-label">Quantit√©</label>
                                    <input type="number" class="form-control" name="quantite"
                                           value="1" min="1" th:max="${produit.stock}" required>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    üõí Ajouter au panier
                                </button>
                            </form>
                        </div>

                        <!-- Message pour les visiteurs non connect√©s -->
                        <div sec:authorize="!isAuthenticated()" class="alert alert-info">
                            <strong>üí° Info :</strong>
                            <a th:href="@{/wickle/connexion}">Connectez-vous</a>
                            pour ajouter ce produit √† votre panier
                        </div>

                        <!-- Message si rupture de stock -->
                        <div th:if="${produit.stock == 0}" class="alert alert-warning">
                            <strong>‚ö†Ô∏è Rupture de stock</strong><br>
                            Ce produit n'est actuellement pas disponible
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bouton retour -->
        <div class="mt-4">
            <a th:href="@{/wickle/visiteur/produits}" class="btn btn-outline-secondary">
                ‚Üê Retour aux produits
            </a>
        </div>
    </div>
</div>

</html>