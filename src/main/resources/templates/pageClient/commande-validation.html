<!DOCTYPE html>
<html th:replace="base :: html" lang="fr" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="content">
    <div class="py-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h1 class="mb-4">‚úÖ Validation de commande</h1>

                <!-- R√©capitulatif du panier -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üì¶ R√©capitulatif de votre commande</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Produit</th>
                                    <th>Variante</th>
                                    <th class="text-center">Quantit√©</th>
                                    <th class="text-end">Prix unitaire</th>
                                    <th class="text-end">Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="ligne : ${panier.lignesPanier}">
                                    <td th:text="${ligne.variante.produit.nom}"></td>
                                    <td>
                                        <small class="text-muted" th:text="${ligne.variante.couleur + ' ‚Ä¢ ' + ligne.variante.taille}"></small>
                                    </td>
                                    <td class="text-center" th:text="${ligne.quantite}"></td>
                                    <td class="text-end" th:text="${ligne.variante.produit.prix} + '‚Ç¨'"></td>
                                    <td class="text-end fw-bold" th:text="${ligne.variante.produit.prix * ligne.quantite} + '‚Ç¨'"></td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Sous-total</strong></td>
                                    <td class="text-end fw-bold" th:text="${total} + '‚Ç¨'"></td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end">Livraison</td>
                                    <td class="text-end" th:text="${total >= 50 ? 'Gratuite' : '4,90‚Ç¨'}"></td>
                                </tr>
                                <tr class="table-primary">
                                    <td colspan="4" class="text-end"><strong>Total √† payer</strong></td>
                                    <td class="text-end fs-5 fw-bold text-primary" th:text="${total < 50 ? total + 4.90 : total} + '‚Ç¨'"></td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Formulaire de validation -->
                <form th:action="@{/wickle/client/commande/valider}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

                    <!-- Informations de livraison -->
                    <div class="card mb-4">
                        <div class="card-header bg-warning">
                            <h5 class="mb-0">üöö Adresse de livraison</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Adresse actuelle</label>
                                <p class="form-control-plaintext" th:text="${utilisateur.adresse}"></p>
                            </div>

                            <div class="mb-3">
                                <label for="adresseLivraison" class="form-label">
                                    Adresse de livraison *
                                </label>
                                <textarea class="form-control" id="adresseLivraison"
                                          name="adresseLivraison" rows="3"
                                          th:text="${utilisateur.adresse}" required></textarea>
                                <small class="text-muted">
                                    Vous pouvez modifier l'adresse si n√©cessaire
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Mode de paiement -->
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">üí≥ Mode de paiement</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <strong>‚ÑπÔ∏è Information :</strong> Le paiement sera effectu√© de mani√®re s√©curis√©e.
                                Pour cette d√©monstration, la validation est imm√©diate.
                            </div>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="paiement" id="cb" checked>
                                <label class="form-check-label" for="cb">
                                    üí≥ Carte bancaire
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="paiement" id="paypal">
                                <label class="form-check-label" for="paypal">
                                    üí∞ PayPal
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Conditions g√©n√©rales -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="acceptCGV" required>
                                <label class="form-check-label" for="acceptCGV">
                                    J'accepte les
                                    <a th:href="@{/wickle/cgv}" target="_blank" class="text-primary">
                                        conditions g√©n√©rales de vente
                                    </a> *
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            ‚úÖ Confirmer la commande
                        </button>
                        <a th:href="@{/wickle/client/panier}" class="btn btn-outline-secondary btn-lg">
                            ‚Üê Retour au panier
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

</html>